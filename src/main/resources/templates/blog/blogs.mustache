{{>header}}
<!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">-->

<div class="container-fluid">
    <button type="button" id="blogSearchBtn" type="button"  class="btn btn-sm btn-primary m-r-5">
        <i class="fa fa-search"></i><!--<i data-domain-id="SEARCH_BTN" >--> 조회</i>
    </button>
    <button type="button" id="blogAddBtn" onClick="getContentUpdate()" class="btn btn-sm btn-info m-r-5">
        <i class="fa fa-plus"></i> <!--<i data-domain-id="MENU_ADD_BTN" >-->글 추가</i>
    </button>



    <table class="table">
        <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">title</th>
        </tr>
        </thead>
        <tbody>
        {{#list}}
            <tr>
            <th scope="row">{{idx}}</th>
            <td ><a href="#" onClick="getContent({{idx}});return false;">{{title}}</a></td>
            </tr>
        {{/list}}

        </tbody>
    </table>

    <form>
        <div class="row mb-3">
            <label for="inputTitle" class="col-sm-2 col-form-label">제목</label>
            <div class="col-sm-10">
                <input type="hidden" class="form-control" id="blogIdx"  readonly>
                <input type="text" class="form-control" id="blogTitle"  readonly>
            </div>
        </div>
    </form>

<!--        <div class="row mb-3">
            <label for="inputPassword3" class="col-sm-2 col-form-label">URL</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="inputPassword3">
            </div>
        </div>-->
<!--        <fieldset class="row mb-3">
            <legend class="col-form-label col-sm-2 pt-0">Radios</legend>
            <div class="col-sm-10">
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios1" value="option1" checked>
                    <label class="form-check-label" for="gridRadios1">
                        First radio
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios2" value="option2">
                    <label class="form-check-label" for="gridRadios2">
                        Second radio
                    </label>
                </div>
                <div class="form-check disabled">
                    <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios3" value="option3" disabled>
                    <label class="form-check-label" for="gridRadios3">
                        Third disabled radio
                    </label>
                </div>
            </div>
        </fieldset>-->
<!--        <div class="row mb-3">
            <div class="col-sm-10 offset-sm-2">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="gridCheck1">
                    <label class="form-check-label" for="gridCheck1">
                        Example checkbox
                    </label>
                </div>
            </div>
        </div>-->

        <div id="blogViewMarkdown" class="container col-xs-w100" >

        </div>
        <div id="blogUpdateMarkdown" class="container  col-xs-w100" style="display:none;">

        </div>
        <button type="button" id="blogUpdateBtn" onClick="getContentUpdate()" class="btn btn-sm btn-warning m-r-5" style="display:none">
            <i class="fa fa-minus"></i>수정하기</i>
        </button>
        <button type="button" id="blogDelBtn"  class="btn btn-sm btn-danger m-r-5" style="display:none;">
            <i class="fa fa-minus"></i>글삭제</i>
        </button>
        <button type="button" id="blogSaveBtn" onClick="save()"  class="btn btn-sm btn-success" style="display:none;">
            <i class="fa fa-download"></i>저장</i>
        </button>

        <div class="container  col-xs-w100">
            <div id="blogRe">


            </div>
        </div>

</div>


<!--<script src="/js/core/simplemde.min.js"></script>-->
{{>footerjs}}

<script src="/js/core/toastui-editor-all.min.js"></script>

<script>
const editor = new toastui.Editor({
    el: document.querySelector('#blogUpdateMarkdown'),
    initialEditType: "wysiwyg",
    height: '500px',
});
const viewer = toastui.Editor.factory({
    el: document.querySelector('#blogViewMarkdown'),
    initialEditType: "wysiwyg",
    viewer: true,
    height: '500px'
});

function getContent(idx){
    $.ajax({
        type : 'GET',
        url : '/blogs/content/'+idx,
        contentType : 'application/json; charset=utf-8'
    }).done(function(data){
        console.log(data);

        //element 세팅
        $('#blogViewMarkdown').css('display', 'block');
        $('#blogUpdateMarkdown').css('display', 'none');
        $('#blogTitle').attr('readonly', true);
        $('#blogUpdateBtn').css('display', 'block');
        $('#blogDelBtn').css('display', 'none');
        $('#blogSaveBtn').css('display', 'none');

        //form 세팅
        $('#blogIdx').val(data.idx);
        $('#blogTitle').val(data.title);
        viewer.setMarkdown(data.markdownContent);

    }).fail(function(error){
        alert(JSON.stringify(error));
    });
}
function getContentUpdate(){
    var idx = $('#blogIdx').val();

    //element 세팅
    $('#blogViewMarkdown').css('display', 'none');
    $('#blogUpdateMarkdown').css('display', 'block');
    $('#blogTitle').attr('readonly', false);
    $('#blogUpdateBtn').css('display', 'none');
    $('#blogDelBtn').css('display', 'block');
    $('#blogSaveBtn').css('display', 'block');

    //form 세팅
    $('#blogIdx').val('');
    $('#blogTitle').val('');
    editor.setMarkdown('');

    if(idx > 0){
        $.ajax({
            type : 'GET',
            url : '/blogs/content/'+idx,
            contentType : 'application/json; charset=utf-8'
        }).done(function(data){
            console.log(data);

            //element 세팅
            $('#blogViewMarkdown').css('display', 'none');
            $('#blogUpdateMarkdown').css('display', 'block');
            $('#blogTitle').attr('readonly', false);
            $('#blogUpdateBtn').css('display', 'none');
            $('#blogDelBtn').css('display', 'block');
            $('#blogSaveBtn').css('display', 'block');

            //form 세팅
            $('#blogIdx').val(data.idx);
            $('#blogTitle').val(data.title);
            editor.setMarkdown(data.markdownContent);

        }).fail(function(error){
            alert(JSON.stringify(error));
        });
    }

}

function save(){
    var idx = $('#blogIdx').val();
    console.log(idx);

    var data = {
        title : $('#blogTitle').val(),
        markdownContent : editor.getMarkdown(),
    }

    var type = 'POST';
    var url = '/blogs/content/';
    if(idx > 0) {
        type = 'PUT';
        url = '/blogs/content/'+idx;
    }

    $.ajax({
        type : type,
        url : url,
        dataType : 'json',
        contentType : 'application/json; charset=utf-8',
        data : JSON.stringify(data)
    }).done(function(data){
        console.log(data);

        alert('저장되었습니다');
        window.location.href='/blogs/';

    }).fail(function(error){
        alert(JSON.stringify(error));
    });
}

</script>

<!--<script src="/js/app/blog/blogs.js"></script>-->
{{>footer}}